{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cerber-core.dev/schemas/output.v1.json",
  "title": "Cerber Output",
  "description": "Deterministic output format from Cerber orchestrator. Same input â†’ identical JSON (ONE TRUTH principle).",
  "type": "object",
  "required": [
    "schemaVersion",
    "deterministic",
    "summary",
    "violations",
    "metadata"
  ],
  "additionalProperties": false,
  "properties": {
    "schemaVersion": {
      "type": "integer",
      "const": 1,
      "description": "Output schema version (current: 1). Increment on breaking changes."
    },
    "deterministic": {
      "type": "boolean",
      "const": true,
      "description": "Output is deterministic (snapshot-testable). Always true."
    },
    "summary": {
      "type": "object",
      "required": ["total", "errors", "warnings", "info"],
      "additionalProperties": false,
      "properties": {
        "total": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of violations"
        },
        "errors": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of error-level violations"
        },
        "warnings": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of warning-level violations"
        },
        "info": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of info-level violations"
        }
      }
    },
    "violations": {
      "type": "array",
      "description": "All violations found, sorted deterministically: path, line, column, id",
      "items": {
        "$ref": "#/definitions/violation"
      }
    },
    "metadata": {
      "type": "object",
      "required": ["tools"],
      "additionalProperties": false,
      "description": "Tool execution metadata",
      "properties": {
        "profile": {
          "type": "string",
          "description": "Profile used (solo/dev/team/custom)",
          "enum": ["solo", "dev", "team", "custom"]
        },
        "target": {
          "type": "string",
          "description": "Target type (github-actions, gitlab-ci, generic-yaml)",
          "examples": ["github-actions"]
        },
        "tools": {
          "type": "object",
          "description": "Tool execution results (keys sorted alphabetically)",
          "additionalProperties": {
            "type": "object",
            "required": ["enabled"],
            "additionalProperties": false,
            "properties": {
              "enabled": {
                "type": "boolean",
                "description": "Whether tool was enabled for this run"
              },
              "version": {
                "type": "string",
                "description": "Tool version if detected"
              },
              "exitCode": {
                "type": "integer",
                "description": "Tool exit code (0=success)"
              },
              "skipped": {
                "type": "boolean",
                "description": "Whether tool was skipped"
              },
              "reason": {
                "type": "string",
                "description": "Reason for skipping",
                "examples": ["not_installed", "not_applicable", "error"]
              }
            }
          }
        }
      }
    },
    "runMetadata": {
      "type": "object",
      "description": "Optional runtime metadata (NOT part of determinism)",
      "additionalProperties": false,
      "properties": {
        "profile": {
          "type": "string",
          "description": "Profile used"
        },
        "executionTime": {
          "type": "integer",
          "description": "Total execution time in milliseconds",
          "minimum": 0
        },
        "cwd": {
          "type": "string",
          "description": "Working directory"
        },
        "generatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp (EXCLUDED from determinism)"
        }
      }
    }
  },
  "definitions": {
    "violation": {
      "type": "object",
      "description": "Single violation from a tool",
      "required": ["id", "severity", "message", "source"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Stable rule ID",
          "examples": ["actionlint/rule", "zizmor/insecure"]
        },
        "severity": {
          "type": "string",
          "enum": ["error", "warning", "info"]
        },
        "message": {
          "type": "string",
          "description": "Human-readable message"
        },
        "path": {
          "type": "string",
          "description": "File path (forward slashes only)",
          "examples": [".github/workflows/ci.yml"]
        },
        "line": {
          "type": "integer",
          "description": "Line number (1-indexed)",
          "minimum": 1
        },
        "column": {
          "type": "integer",
          "description": "Column number (1-indexed)",
          "minimum": 1
        },
        "hint": {
          "type": "string",
          "description": "Fix suggestion"
        },
        "source": {
          "type": "string",
          "description": "Tool name",
          "enum": ["actionlint", "zizmor", "gitleaks", "ratchet", "cerber-semantic"]
        },
        "toolOutput": {
          "type": "object",
          "description": "Original tool output (debugging only)"
        }
      }
    }
  }
}
